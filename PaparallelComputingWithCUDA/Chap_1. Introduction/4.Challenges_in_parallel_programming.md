# 4. Thách thức trong lập trình song song

Điều gì khiến lập trình song song trở nên khó khăn? Có người từng nói rằng nếu bạn không quan tâm đến hiệu năng, lập trình song song rất dễ dàng. Bạn có thể viết một chương trình song song chỉ trong một giờ. Nhưng tại sao lại phải viết một chương trình song song nếu bạn không quan tâm đến hiệu năng?

Cuốn sách này đề cập đến một số thách thức trong việc đạt hiệu năng cao trong lập trình song song. Trước hết, việc thiết kế các thuật toán song song có cùng mức độ phức tạp thuật toán (tính toán) như các thuật toán tuần tự có thể là một thách thức. Nhiều thuật toán song song thực hiện cùng một lượng công việc như các thuật toán tuần tự tương ứng. Tuy nhiên, một số thuật toán song song lại thực hiện nhiều công việc hơn so với các thuật toán tuần tự tương ứng. Thực tế, đôi khi chúng có thể thực hiện nhiều công việc hơn đến mức chạy chậm hơn đối với các tập dữ liệu đầu vào lớn. Đây là HÌNH 1.2 Phạm vi bao phủ của các phần ứng dụng tuần tự và song song. Các phần tuần tự và các phần bao phủ của CPU truyền thống (một nhân) chồng chéo lên nhau. Kỹ thuật GPGPU trước đây cung cấp phạm vi bao phủ rất hạn chế đối với các phần song song dữ liệu, vì nó bị giới hạn ở các phép tính có thể được định dạng thành việc tô điểm ảnh. Các trở ngại đề cập đến các hạn chế về năng lượng khiến việc mở rộng CPU một nhân để bao phủ nhiều phần song song dữ liệu hơn trở nên khó khăn. Đặc biệt là một vấn đề vì xử lý nhanh các tập dữ liệu đầu vào lớn là một động lực quan trọng cho lập trình song song.

Ví dụ, nhiều bài toán thực tế được mô tả một cách tự nhiên nhất bằng các đệ quy toán học. Việc song song hóa các bài toán này thường đòi hỏi cách suy nghĩ không trực quan về bài toán và có thể yêu cầu công việc dư thừa trong quá trình thực thi. Có những nguyên hàm thuật toán quan trọng, chẳng hạn như tổng tiền tố (prefix sum), có thể tạo điều kiện cho việc chuyển đổi công thức đệ quy tuần tự của các bài toán thành các dạng song song hơn. Chúng ta sẽ giới thiệu khái niệm hiệu quả công việc một cách chính thức hơn và sẽ minh họa các phương pháp và sự đánh đổi liên quan đến việc thiết kế các thuật toán song song đạt được cùng mức độ phức tạp tính toán như các thuật toán tuần tự tương ứng của chúng, bằng cách sử dụng các mẫu song song quan trọng như tổng tiền tố trong Chương 11, Tổng tiền tố (Scan).

Thứ hai, tốc độ thực thi của nhiều ứng dụng bị giới hạn bởi độ trễ truy cập bộ nhớ và/hoặc thông lượng. Chúng ta gọi những ứng dụng này là bị ràng buộc bởi bộ nhớ; trái lại, các ứng dụng bị ràng buộc bởi tính toán bị giới hạn bởi số lượng hướng dẫn được thực hiện trên mỗi byte dữ liệu. Việc đạt được hiệu năng thực thi song song cao trong các ứng dụng bị ràng buộc bởi bộ nhớ thường đòi hỏi các phương pháp để cải thiện tốc độ truy cập bộ nhớ. Chúng ta sẽ giới thiệu các kỹ thuật tối ưu hóa cho truy cập bộ nhớ trong Chương 5, Kiến trúc Bộ nhớ và Tính cục bộ Dữ liệu và Chương 6, Cân nhắc về Hiệu năng, và sẽ áp dụng các kỹ thuật này trong một số chương về các mô hình và ứng dụng song song.

Thứ ba, tốc độ thực thi của các chương trình song song thường nhạy cảm hơn với đặc tính dữ liệu đầu vào so với các chương trình tuần tự tương ứng. Nhiều ứng dụng thực tế cần phải xử lý các đầu vào có đặc tính thay đổi rộng rãi, chẳng hạn như kích thước dữ liệu thất thường hoặc không thể dự đoán và phân bố dữ liệu không đồng đều. Những biến đổi về kích thước và phân bố này có thể dẫn đến lượng công việc được phân bổ cho các luồng song song không đồng đều và có thể làm giảm đáng kể hiệu quả của việc thực thi song song. Hiệu năng của các chương trình song song đôi khi có thể thay đổi mạnh mẽ tùy thuộc vào các đặc tính này. Chúng ta sẽ giới thiệu các kỹ thuật để chuẩn hóa phân bố dữ liệu và/hoặc tinh chỉnh động số lượng luồng để giải quyết những thách thức này trong các chương giới thiệu các mô hình và ứng dụng song song.

Thứ tư, một số ứng dụng có thể được song song hóa trong khi yêu cầu ít sự hợp tác giữa các luồng khác nhau. Những ứng dụng này thường được gọi là song song dễ dàng (embarrassingly parallel). Các ứng dụng khác yêu cầu các luồng phải hợp tác với nhau, điều này đòi hỏi phải sử dụng các thao tác đồng bộ hóa như hàng rào hoặc các thao tác nguyên tử. Các thao tác đồng bộ hóa này gây ra chi phí quá mức cho ứng dụng vì các luồng thường sẽ phải chờ các luồng khác thay vì thực hiện công việc hữu ích. Chúng ta sẽ thảo luận về các chiến lược khác nhau để giảm thiểu chi phí quá mức do đồng bộ hóa này trong suốt cuốn sách này.

May mắn thay, hầu hết những thách thức này đã được các nhà nghiên cứu giải quyết. Cũng có những mô hình chung giữa các lĩnh vực ứng dụng cho phép chúng ta áp dụng các giải pháp được tìm ra ở lĩnh vực này cho những thách thức ở các lĩnh vực khác. Đây là lý do chính tại sao chúng tôi sẽ trình bày các kỹ thuật then chốt để giải quyết những thách thức này trong bối cảnh các mô hình và ứng dụng tính toán song song quan trọng.
